<div id="goodsOrder_table">
<script type="text/javascript">
$(function(){
	var datagrid;
	var op;//所传入的对象
	var editRow=undefined;//编辑的行
	var flag;//信息提示
	datagrid=$("#goodsOrder_table").datagrid({
		url:'../SellerGoodsOrderServlet.do',
		queryParams:{op:"findByGoodOrderspage"},//条件查询
		pagination:true,
		pageSize:3,
		pageList:[1,3,5,7,10],
		singleSelect:true,
		columns:[[

			{field:'gid',title:'商品',width:80,align:'center',
					formatter:function(vslue,row){
							return row.gid+'-'+row.gtitle1;
						}
			},
			{field:'oid',title:'订单表号',width:80,align:'center'},
			{field:'oidentifier',title:'订单号',width:80,align:'center'},
			{field:'muid',title:'用户账号',width:80,align:'center'},
			{field:'otime',title:'下单时间',width:80,align:'center'},
			{field:'ostatus',title:'订单状态',width:100,align:'center',editor:{type:"text",options:{required:true}}},
			{field:'opwd',title:'美团券密码',width:80,align:'center',formatter: function(value,row,index){return "******"}},
			{field:'opaytime',title:'付款时间',width:80,align:'center'},
			{field:'ocount',title:'数量',width:80,align:'center'},
			
		]],
		toolbar:[{
			text:'接收订单',
			iconCls:'icon-edit',
			handler:function(){
				//alert("edit");
				flag="修改";
				var rows=datagrid.datagrid("getSelected");//所有的复选框
				if(rows==undefined){
					$.messager.show({title:'温馨提示',msg:'请选择您要修改的数据',timeout:2000,showType:'slide'});//
				}else{
					op="updateOrder";
					if(editRow!=undefined){
						datagrid.datagrid("rejectChanges");//回滚自创建以来或自上次调用acceptChanges,所有的变化数据
						datagrid.datagrid("endEdit",editRow);//关闭当前正在编辑的行
						editRow=undefined;
					}else{
						var index=datagrid.datagrid("getRowIndex",rows);//获取当前选择航的索引
						datagrid.datagrid("updateRow",{index:index, row:rows});
						//打开编辑器，编辑当前行
						datagrid.datagrid("beginEdit",index);
						editRow=index;//记录当前被编辑的行
					}
				}
			}
		},'-',{
			text:'保存',
			iconCls:'icon-save',
			handler:function(){
				datagrid.datagrid("endEdit",editRow);//关闭当前正在编辑的行
				//获取当前被修改的而数据
			//	alert( atagrid.datagrid("getChanges").getSelected );
				var rows=datagrid.datagrid("getSelected");
				if(rows==undefined){
					datagrid.datagrid("rejectChanges");//回滚自创建以来或自上次调用acceptChanges,所有的变化数据
					datagrid.datagrid("unselectAll");
					editRow=undefined;
				}else{
					rows["op"]=op;//alert(rows);
					$.post("../SellerGoodsOrderServlet.do",rows,function(data){//回调函数
						if(data=1){
							$.messager.show({
								title:'温馨提示',
								msg:'信息'+flag+'成功。。。',
								timeout:2000,
								showType:'slide'
							});
						}else{
							$.messager.alert("失败提醒","商家'+flag+'失败。。。","error");
						}
						
						datagrid.datagrid("reload");//重新加载数据
						datagrid.datagrid("rejectChanges");//回滚自创建以来或自上次调用acceptChanges,所有的变化数据
						datagrid.datagrid("unselectAll");
					});
				}
			}
		},'-',{
			text:'撤销',
			iconCls:'icon-redo',
			handler:function(){
				//alert("redo");
				datagrid.datagrid("rejectChanges");//回滚自创建以来或自上次调用acceptChanges,所有的变化数据
				datagrid.datagrid("endEdit",editRow);//关闭当前正在编辑的行
				editRow=undefined;
				}
		
		}]
	});
});
</script>
</div>